
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>SynergyCloud Social Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href="/static/bootstrap.min.css" rel="stylesheet">
    <link href="/static/bootstrap-responsive.min.css" rel="stylesheet">


    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      .postinput { width: 100%;}
    </style>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="/static/bootstrap.min.js"></script>   
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBdiSflf9kIwXQEQmCA_TfhJCeY0kafbIs&sensor=true">
    </script>
    <script type="text/javascript">
      var marker_array = []; //eventually we'll send these to the DB
      var temp_marker; //marker that gets put down on map click
      var tempLatLng; //need to store coords if marker becomes a post
      $(document).ready(function() {

        //hide the form for making post
        $(".postform").hide();

        //Google map initializing stuff
        var latlng = new google.maps.LatLng(33.7489, -84.3881);

        var myOptions = {
          zoom: 10,
          center: latlng,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions); 


        //click event for map -- form slides down, marker is placed on map
        google.maps.event.addListener(map, 'click', function(event){
          if (temp_marker)
            return false; //prevents >1 marker on map
          
          $('.postform').slideDown('slow');

          tempLatLng = event.latLng
          marker = new google.maps.Marker({
            position: tempLatLng,
            map: map
          });

          //assign to temp marker & show
          temp_marker = marker;
          temp_marker.setMap(map);
        });

        //cancel button - form slides up
        $(".cancelpost").click(function(){
          $(this).parent().slideToggle('slow');
          LEAVE_NO_SURVIVORS();
          return false;
        });


        //post that sucka
        $(".makepost").click(function(){
          //make sure there's a marker on the map and people actually posted something about it
          if (!temp_marker)
            return false;

          var post_content = $("input.postinput").val();
          if (post_content == ""){
            $("input.postinput").focus();
            return false;
          }
          
          //create the info window, create new marker, attach info to marker
          var info_window = new google.maps.InfoWindow({content: post_content});
          var perm_marker = new google.maps.Marker({
            position: tempLatLng,
            map: map,
          });
         
          google.maps.event.addListener(perm_marker, 'click', function(){
            info_window.open(map, perm_marker);
          });

          //we'll use AJAX to send this to the DB whenever that gets working
          marker_array.push(perm_marker);

          //clean-up time
          $(this).parent().slideToggle('slow');
          LEAVE_NO_SURVIVORS(); 
          $("input.postinput").val('');
             
          return false;
        });

        // DESTROY KILL DESTROY
        function LEAVE_NO_SURVIVORS(){
          temp_marker.setMap(null);
          temp_marker = null;
          tempLatLng = null;
        }
      });




  </script>
  </head>
  <body>
  <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">SynergyCloud Social Map</a>
          <div class="nav-collapse">
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div> 
    <br />
    <br />
    <br />
    <br />
    <br />
    <div class="span8" style="padding-left:15%;" id="postform">
      <form class="well form-inline postform">
        <input type="text" class="postinput" placeholder="Post Your Post">
        </label>
        <button class="btn cancelpost">Cancel</button>
        <button type="submit" class="btn btn-success makepost">Post</button>
        
      </form>
    </div>

    <div class="container" id="map_canvas" style="width: 80%; height: 80%;"></div> 
 </div>
</body>
</html>